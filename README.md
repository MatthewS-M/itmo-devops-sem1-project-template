# Финальный проект 1 семестра

REST API сервис для загрузки и выгрузки данных о ценах.

## Требования к системе

- Go версии 1.23 или выше
- PostgreSQL версии 14 или выше
- Bash shell
- Для удаленного деплоя: SSH доступ к серверу

## Технологии

- **Язык программирования**: Go 1.23
- **База данных**: PostgreSQL
- **HTTP роутер**: Gorilla Mux
- **Драйвер БД**: lib/pq

## Установка и запуск

### Подготовка окружения

Запустите скрипт `prepare.sh` для установки зависимостей и подготовки базы данных:

```bash
./scripts/prepare.sh
```

Скрипт выполняет:
- Установку зависимостей Go (`go mod download`)
- Установку PostgreSQL (если не установлен)
- Создание пользователя `validator` с паролем `val1dat0r`
- Создание базы данных `project-sem-1`
- Создание таблицы `prices`

### Локальный запуск

Для локального запуска приложения:

```bash
./scripts/run.sh
```

Если переменные окружения `SSH_HOST` и `SSH_USER` не заданы, скрипт запустит приложение локально на порту 8080.

### Удаленный деплой

Для развертывания на удаленном сервере через SSH задайте переменные окружения:

```bash
export SSH_HOST="your-server-ip"
export SSH_USER="your-username"
export SSH_KEY="/path/to/ssh/key"  # опционально
export SSH_PORT="22"  # опционально, по умолчанию 22

./scripts/run.sh
```

Скрипт:
- Скопирует файлы проекта на удаленный сервер
- Установит зависимости (Go, PostgreSQL)
- Настроит базу данных
- Запустит приложение
- Вернет IP-адрес сервера

## API Эндпоинты

### POST /api/v0/prices?type=zip

Загружает архив с данными и сохраняет их в базу данных.

**Параметры запроса:**
- `type` (опционально): тип архива (`zip` или `tar`). По умолчанию `zip`.

**Тело запроса:**
- Multipart form с полем `file`, содержащим zip или tar архив
- Архив должен содержать файл `data.csv` со следующими полями:
  - `id` - идентификатор продукта (целое число)
  - `name` - название продукта
  - `category` - категория продукта
  - `price` - цена (десятичное число)
  - `create_date` - дата создания в формате `YYYY-MM-DD`

**Пример запроса:**
```bash
curl -F "file=@data.zip" "http://localhost:8080/api/v0/prices?type=zip"
```

**Ответ:**
```json
{
  "total_items": 100,
  "total_categories": 15,
  "total_price": 100000
}
```

### GET /api/v0/prices

Получает все записи из базы данных в виде zip-архива.

**Ответ:**
- Zip-архив с файлом `data.csv`, содержащим все записи из таблицы `prices`

**Пример запроса:**
```bash
curl -O "http://localhost:8080/api/v0/prices"
```

## Конфигурация базы данных

По умолчанию используются следующие параметры:
- **Хост**: localhost
- **Порт**: 5432
- **Пользователь**: validator
- **Пароль**: val1dat0r
- **База данных**: project-sem-1
- **Таблица**: prices

Параметры можно изменить через переменные окружения:
- `POSTGRES_HOST`
- `POSTGRES_PORT`
- `POSTGRES_USER`
- `POSTGRES_PASSWORD`
- `POSTGRES_DB`

## Тестирование

Для запуска тестов используйте скрипт `tests.sh`:

```bash
./scripts/tests.sh 2
```

Где `2` - уровень сложности (продвинутый уровень).

Тесты проверяют:
- Корректность работы POST эндпоинта с zip и tar архивами
- Корректность работы GET эндпоинта
- Состояние базы данных PostgreSQL

## Структура проекта

```
.
├── main.go              # Основной код сервера
├── go.mod               # Зависимости Go
├── go.sum               # Checksums зависимостей
├── scripts/
│   ├── prepare.sh       # Скрипт подготовки окружения
│   ├── run.sh           # Скрипт запуска/деплоя
│   └── tests.sh         # Скрипт тестирования
└── README.md            # Документация
```

## Контакт

В случае вопросов обращайтесь к разработчику проекта.
